variables:
  BUILD_FOLDER: public/build/

assets_build:
  stage: build
  before_script:
    - "NPM_NODE_VERSION=$(node -p \"require('./package.json').config.node\")"
  artifacts:
    paths:
      - $BUILD_FOLDER
      - node_modules/
  script:
    - 'echo Node version: $NPM_NODE_VERSION'
    - 'nvm install $NPM_NODE_VERSION'
    - 'nvm use $NPM_NODE_VERSION'
    - 'yarn global add webpack-cli'
    - 'yarn install --frozen-lockfile --cache-folder .yarn-cache --prefer-offline'
    - "NODE_ENV=prod ./node_modules/.bin/webpack -p --config webpack/webpack.config.js"
