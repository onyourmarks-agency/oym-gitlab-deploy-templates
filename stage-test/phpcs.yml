phpcs:
  stage: test
  variables:
    GIT_STRATEGY: fetch
  needs:
    - job: composer_install
      artifacts: true
      optional: true
  script:
    - 'phpcs --error-severity=$PHPCS_ERROR_SEVERITY --warning-severity=$PHPCS_WARNING_SEVERITY --extensions=php'
  rules:
    - if: '$PHPCS_MODE == "strict"'
      changes:
        - src/*
        - modules/*
        - composer.json
        - composer.lock
      allow_failure: false
    - if: '$PHPCS_MODE == "relaxed"'
      changes:
        - src/*
        - modules/*
        - composer.json
        - composer.lock
      allow_failure: true
    - if : '$CI_COMMIT_MESSAGE =~ /CI_BUILD/ && $PHPCS_MODE == "strict"'
      allow_failure: false
    - if : '$CI_COMMIT_MESSAGE =~ /CI_BUILD/ && $PHPCS_MODE == "relaxed"'
      allow_failure: true
    - if: '$PHPCS_MODE == "disabled"'
      when: never

