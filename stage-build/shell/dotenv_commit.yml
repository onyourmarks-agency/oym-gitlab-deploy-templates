---
dotenv_commit:
  stage: build
  variables:
    GIT_STRATEGY: fetch
  needs: []
  artifacts:
    paths:
      - '.env*'
  script:
    - '[[ -f $PRODUCTION_ENV_FILE ]] && sed -i "s/\$VAR_COMMIT_ID/$CI_COMMIT_SHORT_SHA/" $PRODUCTION_ENV_FILE'
    - '[[ -f $STAGING_ENV_FILE ]] && sed -i "s/\$VAR_COMMIT_ID/$CI_COMMIT_SHORT_SHA/" $STAGING_ENV_FILE'
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: never
    - exists: ['$PRODUCTION_ENV_FILE', '$STAGING_ENV_FILE']
