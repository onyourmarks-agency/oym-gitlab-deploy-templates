dotenv_commit:
  image: ${CI_REGISTRY_IMAGE}:${CI_COMMIT_SHA}
  stage: build
  variables:
    GIT_STRATEGY: fetch
  needs: [ image_build ]
  artifacts:
    paths:
      - '.env*'
  script:
    - '[[ -f $PRODUCTION_ENV_FILE ]] && sed -i "s/\$VAR_COMMIT_ID/$CI_COMMIT_SHORT_SHA/" $PRODUCTION_ENV_FILE'
    - '[[ -f $STAGING_ENV_FILE ]] && sed -i "s/\$VAR_COMMIT_ID/$CI_COMMIT_SHORT_SHA/" $STAGING_ENV_FILE'
  rules:
    - exists:
      - '$PRODUCTION_ENV_FILE'
      - '$STAGING_ENV_FILE'
